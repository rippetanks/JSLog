/*
  This Source Code Form is subject to the terms of the Mozilla Public
  License, v. 2.0. If a copy of the MPL was not distributed with this
  file, You can obtain one at http://mozilla.org/MPL/2.0/.
*/

/**
*
* @author Simone Martelli
* @version 1.0.0
*/
const JSLog=function(){function a(m){return $.ajax({url:k.url,method:'POST',contentType:'application/json',data:JSON.stringify(m),success:function(o,p,q){k.enable_internal_log&&h.log('JSLog HTTP '+q.status+'!'),k.callback_success&&k.callback_success(o,p,q)},error:function(o,p,q){k.enable_internal_log&&h.error('JSLog HTTP '+o.status+'! '+q),k.callback_error&&k.callback_error(o,p,q)}})}function b(){console={assert:function(m,...o){k.enable_internal_log||h.assert(m,o),m||JSLog.bulk(g.ASSERT,o)},debug:function(...m){return k.enable_internal_log||h.debug(m),JSLog.bulk(g.DEBUG,m)},error:function(...m){return k.enable_internal_log||h.error(m),JSLog.bulk(g.ERROR,m)},info:function(...m){return k.enable_internal_log||h.info(m),JSLog.bulk(g.INFO,m)},log:function(...m){return k.enable_internal_log||h.info(m),JSLog.bulk(g.INFO,m)},trace:function(...m){return k.enable_internal_log||h.trace(m),JSLog.bulk(g.TRACE,m)},warn:function(...m){return k.enable_internal_log||h.warn(m),JSLog.bulk(g.WARN,m)}}}function c(m){let o=m.filter(function(p){return p.level[1]>=k.level[1]});return l?(o.forEach(function(p){p.level=p.level[0],p=jQuery.extend(p,l),p.httpCode||delete p.httpCode}),a(o)):void h.warn('Call the init function first!')}function f(){let m={};return k.entity&&(m.entity=k.entity),k.log_key&&(m.log_key=k.log_key),m}const g={TRACE:['TRACE',0],DEBUG:['DEBUG',1],INFO:['INFO',2],WARN:['WARN',3],ERROR:['ERROR',4],ASSERT:['ASSERT',4],FATAL:['FATAL',5]},h=console;let j=[],k={url:null,entity:null,level:g.TRACE,log_key:null,ajax:a,cache:null,console_override:!1,enable_internal_log:!1,callback_success:null,callback_error:null},l;return{init:function(m){k=jQuery.extend(k,m),k.url||console.warn('Please, set a URL!'),k.console_override&&this.override(),l=f()},log:function(m,o,p){if(!m||!o)return h.warn('Incomplete data!'),!1;if(1<=k.cache){if(j.push({level:m,message:o,httpCode:p,datetime:new Date().toISOString()}),j.length===k.cache){let q=Array.from(j);return j=[],c(q)}return!1}return c([{level:m,message:o,httpCode:p,datetime:new Date().toISOString()}])},bulk:function(m,...o){let p=[];for(let q=0;q<o.length;q++)p[q]=this.log(m,o[q]);return p},trace:function(m,o){return this.log(g.TRACE,m,o)},debug:function(m,o){return this.log(g.DEBUG,m,o)},info:function(m,o){return this.log(g.INFO,m,o)},warn:function(m,o){return this.log(g.WARN,m,o)},error:function(m,o){return this.log(g.ERROR,m,o)},fatal:function(m,o){return this.log(g.FATAL,m,o)},getLevel:function(){return k.level},getLevelString:function(){return k.level[0]},setLevel:function(m){k.level=m},override:function(){b()},nativeConsole:function(){return h},enableCache:function(m){k.cache=m},disableCache:function(){k.cache=null},cacheSize:function(){return j.length},flush:function(){return!!(0<j.length)&&c(j)},LOG_LEVEL:g}}();Object.freeze(JSLog.LOG_LEVEL),Object.freeze(JSLog);
